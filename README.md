# Web3 PAM Authentication System

ä¸€ä¸ªåŸºäºWeb3é’±åŒ…ç­¾åéªŒè¯çš„PAMï¼ˆPluggable Authentication Moduleï¼‰è®¤è¯ç³»ç»Ÿï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ä»¥å¤ªåŠé’±åŒ…è¿›è¡Œç³»ç»Ÿç™»å½•ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **Web3é’±åŒ…è®¤è¯**: ä½¿ç”¨ä»¥å¤ªåŠé’±åŒ…ç§é’¥è¿›è¡Œç­¾åéªŒè¯
- ğŸ›¡ï¸ **å®‰å…¨æŒ‘æˆ˜æœºåˆ¶**: æœåŠ¡å™¨ç”ŸæˆéšæœºæŒ‘æˆ˜ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»
- âš¡ **é«˜æ€§èƒ½**: åŸºäºCè¯­è¨€å®ç°ï¼Œæ€§èƒ½ä¼˜å¼‚
- ğŸ”§ **æ˜“äºé›†æˆ**: æ ‡å‡†PAMæ¨¡å—ï¼Œå¯è½»æ¾é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- ğŸ“¡ **RESTful API**: æä¾›HTTP APIæ¥å£è¿›è¡Œè®¤è¯æœåŠ¡
- ğŸ¯ **è·¨å¹³å°**: æ”¯æŒLinuxç³»ç»Ÿ

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PAM Module    â”‚    â”‚  Auth Server    â”‚    â”‚  Web3 Wallet    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ 1. è·å–æŒ‘æˆ˜     â”‚â”€â”€â”€â–¶â”‚ 2. ç”ŸæˆæŒ‘æˆ˜     â”‚    â”‚ 3. ç­¾åæŒ‘æˆ˜     â”‚
â”‚ 4. éªŒè¯ç­¾å     â”‚â—€â”€â”€â”€â”‚ 5. éªŒè¯ç»“æœ     â”‚â—€â”€â”€â”€â”‚                 â”‚
â”‚ 6. ç™»å½•æˆåŠŸ     â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è®¤è¯æµç¨‹

1. **ç”¨æˆ·ç™»å½•**: ç”¨æˆ·å°è¯•ç™»å½•ç³»ç»Ÿ
2. **è·å–æŒ‘æˆ˜**: PAMæ¨¡å—å‘è®¤è¯æœåŠ¡å™¨è¯·æ±‚ç­¾åæŒ‘æˆ˜
3. **é’±åŒ…ç­¾å**: ç”¨æˆ·ä½¿ç”¨Web3é’±åŒ…å¯¹æŒ‘æˆ˜è¿›è¡Œç­¾å
4. **éªŒè¯ç­¾å**: æœåŠ¡å™¨éªŒè¯ç­¾åçš„æœ‰æ•ˆæ€§
5. **ç™»å½•æˆåŠŸ**: éªŒè¯é€šè¿‡åå…è®¸ç”¨æˆ·ç™»å½•

## å®‰è£…è¦æ±‚

### ç³»ç»Ÿä¾èµ–

- Linuxæ“ä½œç³»ç»Ÿ
- GCCç¼–è¯‘å™¨
- PAMå¼€å‘åº“
- OpenSSLå¼€å‘åº“
- JSON-Cåº“
- libcurlåº“

### Ubuntu/Debianå®‰è£…ä¾èµ–

```bash
sudo apt-get update
sudo apt-get install -y build-essential libpam0g-dev libssl-dev libjson-c-dev libcurl4-openssl-dev
```

### CentOS/RHELå®‰è£…ä¾èµ–

```bash
sudo yum groupinstall -y "Development Tools"
sudo yum install -y pam-devel openssl-devel json-c-devel libcurl-devel
```

## ç¼–è¯‘å®‰è£…

### 1. æ£€æŸ¥ä¾èµ–

```bash
make check-deps
```

### 2. ç¼–è¯‘æ‰€æœ‰ç»„ä»¶

```bash
make all
```

### 3. å®‰è£…ç»„ä»¶

```bash
sudo make install
```

### 4. åˆ›å»ºsystemdæœåŠ¡

```bash
make install-service
sudo cp web3-auth-server.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable web3-auth-server
sudo systemctl start web3-auth-server
```

## é…ç½®è¯´æ˜

### PAMé…ç½®

åœ¨PAMé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š

```
auth required pam_web3.so server_url=http://localhost:8080 timeout=30
```

### æœåŠ¡å™¨é…ç½®

è®¤è¯æœåŠ¡å™¨é»˜è®¤ç›‘å¬8080ç«¯å£ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æºç ä¸­çš„`PORT`å¸¸é‡æ¥æ›´æ”¹ã€‚

### å®¢æˆ·ç«¯é…ç½®

å®¢æˆ·ç«¯ç¤ºä¾‹ç¨‹åºéœ€è¦æä¾›ç”¨æˆ·åå’Œç§é’¥ï¼š

```bash
./web3_client_example <username> <private_key_hex>
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨è®¤è¯æœåŠ¡å™¨

```bash
# ä½¿ç”¨systemdæœåŠ¡
sudo systemctl start web3-auth-server

# æˆ–ç›´æ¥è¿è¡Œ
./web3_auth_server
```

### 2. é…ç½®PAM

ç¼–è¾‘PAMé…ç½®æ–‡ä»¶ï¼ˆå¦‚`/etc/pam.d/login`ï¼‰ï¼š

```
# æ·»åŠ Web3è®¤è¯
auth required pam_web3.so server_url=http://localhost:8080 timeout=30
```

### 3. æµ‹è¯•å®¢æˆ·ç«¯

```bash
# ä½¿ç”¨ç¤ºä¾‹å®¢æˆ·ç«¯æµ‹è¯•
./web3_client_example alice 1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
```

### 4. ç³»ç»Ÿç™»å½•

ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç™»å½•ï¼š

1. ä½¿ç”¨SSHç™»å½•
2. ä½¿ç”¨æœ¬åœ°ç»ˆç«¯ç™»å½•
3. ä½¿ç”¨å›¾å½¢ç•Œé¢ç™»å½•

## APIæ¥å£

### è·å–æŒ‘æˆ˜

**è¯·æ±‚:**
```http
POST /api/challenge
Content-Type: application/json

{
    "username": "alice"
}
```

**å“åº”:**
```json
{
    "challenge": "a1b2c3d4e5f6...",
    "nonce": "1234567890abcdef...",
    "timestamp": 1640995200,
    "message": "a1b2c3d4e5f6..."
}
```

### éªŒè¯ç­¾å

**è¯·æ±‚:**
```http
POST /api/verify
Content-Type: application/json

{
    "address": "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6",
    "signature": "0x1234567890abcdef...",
    "challenge": "a1b2c3d4e5f6..."
}
```

**å“åº”:**
```json
{
    "success": true,
    "message": "Authentication successful",
    "username": "alice"
}
```

## å®‰å…¨è€ƒè™‘

### 1. ç§é’¥å®‰å…¨

- ç§é’¥åº”è¯¥å®‰å…¨å­˜å‚¨ï¼Œä¸è¦ç¡¬ç¼–ç åœ¨ç¨‹åºä¸­
- å»ºè®®ä½¿ç”¨ç¡¬ä»¶é’±åŒ…æˆ–å®‰å…¨çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿ
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç§é’¥åº”è¯¥é€šè¿‡å®‰å…¨çš„æ–¹å¼ä¼ é€’ç»™å®¢æˆ·ç«¯

### 2. ç½‘ç»œå®‰å…¨

- å»ºè®®ä½¿ç”¨HTTPSè¿›è¡Œé€šä¿¡
- å®æ–½é€‚å½“çš„é˜²ç«å¢™è§„åˆ™
- è€ƒè™‘ä½¿ç”¨VPNæˆ–ä¸“ç”¨ç½‘ç»œ

### 3. æŒ‘æˆ˜æœºåˆ¶

- æŒ‘æˆ˜å…·æœ‰æ—¶æ•ˆæ€§ï¼ˆé»˜è®¤5åˆ†é’Ÿï¼‰
- æ¯ä¸ªæŒ‘æˆ˜åªèƒ½ä½¿ç”¨ä¸€æ¬¡
- ä½¿ç”¨åŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ pam_web3.h              # PAMæ¨¡å—å¤´æ–‡ä»¶
â”œâ”€â”€ pam_web3.c              # PAMæ¨¡å—å®ç°
â”œâ”€â”€ web3_auth_server.c      # è®¤è¯æœåŠ¡å™¨
â”œâ”€â”€ web3_client_example.c   # å®¢æˆ·ç«¯ç¤ºä¾‹
â”œâ”€â”€ Makefile                # æ„å»ºé…ç½®
â””â”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
```

### ç¼–è¯‘é€‰é¡¹

```bash
# è°ƒè¯•ç‰ˆæœ¬
make debug

# å‘å¸ƒç‰ˆæœ¬
make release

# æ¸…ç†æ„å»ºæ–‡ä»¶
make clean
```

### æµ‹è¯•

```bash
# æµ‹è¯•ç¼–è¯‘
make test-compile

# è¿è¡ŒæœåŠ¡å™¨
make run-server

# æµ‹è¯•å®¢æˆ·ç«¯
make test-client
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯**: æ£€æŸ¥æ˜¯å¦å®‰è£…äº†æ‰€æœ‰ä¾èµ–åº“
2. **PAMæ¨¡å—åŠ è½½å¤±è´¥**: æ£€æŸ¥æ¨¡å—è·¯å¾„å’Œæƒé™
3. **æœåŠ¡å™¨è¿æ¥å¤±è´¥**: æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œå’Œç½‘ç»œè¿æ¥
4. **ç­¾åéªŒè¯å¤±è´¥**: æ£€æŸ¥ç§é’¥å’Œç­¾åæ ¼å¼

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹PAMæ—¥å¿—
sudo tail -f /var/log/auth.log

# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
sudo journalctl -u web3-auth-server -f
```

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§LICENSEæ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- åˆ›å»ºIssue
- å‘é€é‚®ä»¶
- æäº¤Pull Request

## æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒåŸºæœ¬çš„Web3é’±åŒ…è®¤è¯
- æä¾›PAMæ¨¡å—å’Œè®¤è¯æœåŠ¡å™¨
- åŒ…å«å®¢æˆ·ç«¯ç¤ºä¾‹ç¨‹åº
